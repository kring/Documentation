<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Development Environment - TerriaJS</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Development Environment";
    var mkdocs_page_input_path = "Contributors\\Development-environment.md";
    var mkdocs_page_url = "/Contributors/Development-environment/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> TerriaJS</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../GettingStarted/">Getting Started</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Catalog Management</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../CatalogManagement/">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../CatalogManagement/CKAN/">CKAN</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../CatalogManagement/GeoJSON/">GeoJSON</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../CatalogManagement/Web-Map-Service/">Web Map Service (WMS)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../CatalogManagement/Performance-testing/">Performance Testing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../CatalogManagement/Handling-CORS/">Issues with CORS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../CatalogManagement/Initialization-File/">Initialization File</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../CatalogManagement/Format-Conversion-Service/">Format Conversion Service</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Customizing</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Customizing/">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Customizing/Config-JSON/">Config JSON</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Customizing/How-to-skin-a-Terria-Map/">Skinning</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Customizing/TerriaJS-URL-parameters/">URL Parameters</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Customizing/TerriaJS-in-iframe/">Controlling in an iframe</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Customizing/Extending-TerriaJS/">Extending TerriaJS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Customizing/CKAN-previewer/">CKAN Previewer</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Customizing/WPS-parameters-guide/">WPS Parameters</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Deployment</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Deployment/">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Deployment/Deploying-Terria-Map/">Deploying TerriaMap</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Deployment/Deploying-and-building-TerriaJS/">Deploying and Building</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Deployment/Overall-system-architecture/">Overall System Architecture</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Deployment/Problems-and-Solutions/">Problems and Solutions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Deployment/Setting-up-a-region-mapping-server/">Setting up a Region Mapping Server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Deployment/Using-a-vector-tile-source-for-region-mapping/">Using a Vector Tile Source</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Deployment/WMS-Services/">WMS Services</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Contributors</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Development Environment</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#setting-up-a-terriajs-development-environment">Setting up a TerriaJS development environment</a></li>
                
                    <li><a class="toctree-l4" href="#updating-build">Updating Build</a></li>
                
                    <li><a class="toctree-l4" href="#building-a-terria-based-site-against-a-modified-terriajs">Building a Terria based site against a modified TerriaJS</a></li>
                
                    <li><a class="toctree-l4" href="#committing-modifications">Committing modifications</a></li>
                
                    <li><a class="toctree-l4" href="#release-build">Release Build</a></li>
                
                    <li><a class="toctree-l4" href="#documentation">Documentation</a></li>
                
                    <li><a class="toctree-l4" href="#tests-specs">Tests / Specs</a></li>
                
                    <li><a class="toctree-l4" href="#gulp-tasks">Gulp Tasks</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Contributing-to-TerriaJS/">Working with TerriaJS and Cesium</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Setting-up-Saucelabs-Locally/">Setting up Saucelabs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Using-Docker/">Using Docker</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">TerriaJS</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Contributors &raquo;</li>
        
      
    
    <li>Development Environment</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="setting-up-a-terriajs-development-environment">Setting up a TerriaJS development environment</h1>
<p>First, <a href="../../Deployment/Deploying-Terria-Map/">deploy and build your instance</a>.</p>
<h2 id="updating-build">Updating Build</h2>
<p>The following commands are what you would normally run to pull changes from GitHub and build them:</p>
<pre><code>git pull --rebase
npm install
gulp
npm start
</code></pre>

<h2 id="building-a-terria-based-site-against-a-modified-terriajs">Building a Terria based site against a modified TerriaJS</h2>
<p>What if you need to make changes to <a href="https://github.com/TerriaJS/terriajs">TerriaJS</a> while working on a site that depends on it?</p>
<p>In the process above, the <a href="https://www.npmjs.com/package/terriajs">TerriaJS package</a> is installed to the <code>node_modules</code> directory by <code>npm install</code>.  Please do not edit TerriaJS directly in the <code>node_modules</code> directory, because changes will be clobbered the next time you run <code>npm install</code>.  Instead, follow these instructions.</p>
<p>First, set up a TerriaJS dev environment on your system by following the <a href="https://github.com/TerriaJS/terriajs/wiki/Developers%27-Handbook">instructions</a>.  Then, checkout an appropriate version of TerriaJS.  To use the exact version that National Map is expecting, do:</p>
<pre><code class="bash">cd nationalmap
grep terriajs package.json
# will print something like: &quot;terriajs&quot;: &quot;0.0.23&quot;
cd ../terriajs
git checkout 0.0.23 # version from above

# Create a new branch to hold your changes.
git checkout -b someBranchName
</code></pre>

<p>If you're planning to upgrade National Map's version of TerriaJS, you may choose to use <code>master</code> instead of the precise version listed in <code>package.json</code>.</p>
<p>Next, link your local version of TerriaJS into the global npm package repository:</p>
<pre><code>cd terriajs
npm link
</code></pre>

<p>Then, link the now global <code>terriajs</code> package into National Map:</p>
<pre><code>cd nationalmap
npm link terriajs
</code></pre>

<p>This process essentially makes National Map's <code>node_modules/terriajs</code> into a symlink to your <code>terriajs</code> directory cloned from git.  Any changes you make to TerriaJS will be automatically picked up by National Map.  Don't forget to run <code>npm install</code> in TerriaJS after pulling new changes or modifying <code>package.json</code>.  You will also need to build TerriaJS (by running <code>gulp</code>) if you modify any Cesium shaders or make changes to Cesium code that could affect Cesium's WebWorkers.</p>
<p>To switch National Map back to using the npm version of TerriaJS, do:</p>
<pre><code>npm unlink terriajs
npm install
</code></pre>

<h2 id="committing-modifications">Committing modifications</h2>
<p>If you make changes to TerriaJS and National Map together, here's the process for getting them to production.</p>
<p>First, commit your TerriaJS changes to a branch and open a pull request to merge that branch to master. Simultaneously, you may want to make a branch of National Map that uses your modified version of TerriaJS.  To do that, modify National Map's <code>package.json</code>.  Where it has a line like:</p>
<pre><code>&quot;terriajs&quot;: &quot;^0.0.27&quot;,
</code></pre>

<p>Change it to:</p>
<pre><code>&quot;terriajs&quot;: &quot;git://github.com/TerriaJS/terriajs.git#branchName&quot;,
</code></pre>

<p>Replace <code>branchName</code> with the name of the TerriaJS branch you want to use.  You may even use a repository other than <code>TerriaJS/terriajs</code> if your branch is in a fork of TerriaJS instead of in the official repository.</p>
<p>Once your TerriaJS pull request has been merged and a new version of the <code>terriajs</code> npm module has been published, please remember to update <code>package.json</code> to point to an official <code>terriajs</code> version instead of a branch in a GitHub repo.</p>
<p>When at all possible, the <code>package.json</code> in the <code>master</code> branch should point to official releases of <code>terriajs</code> on npm, NOT GitHub branches.</p>
<h2 id="release-build">Release Build</h2>
<p>If you want to make a minified release build use the commands:</p>
<pre><code>npm install
gulp release
npm start
</code></pre>

<h2 id="documentation">Documentation</h2>
<p>Documentation is automatically generated from the source via jdocs.  It will be placed in the public/doc folder.  </p>
<p>It is still very early stages, so the documentation is rather minimal and referencing the source code is probably a better way to determine the best way to use the existing functionality.</p>
<p>You can click <a href="http://nationalmap.gov.au/build/TerriaJS/doc/">here</a> to reference the documentation on the National Map site.</p>
<h2 id="tests-specs">Tests / Specs</h2>
<p>The test suite is run by opening a web browser on <a href="http://localhost:3001/SpecRunner.html">http://localhost:3001/SpecRunner.html</a>.  The specs themselves are found in the <code>test/</code> directory.</p>
<h2 id="gulp-tasks">Gulp Tasks</h2>
<ul>
<li>default - Invoked by running gulp without any arguments, this task invokes the <code>build</code> and <code>lint</code> tasks.</li>
<li><code>build</code> - Builds a non-minified version of National Map AND Cesium, together in one JS file (called <code>public/build/ausglobe.js</code>). Only the parts of Cesium that we use (directly or indirectly) are pulled in. This task builds both the application and the specs.  This task may take 10 seconds or more, which is the main reason for the next task.</li>
<li><code>watch</code> - Starts the same as <code>build</code> but then it stays running and watches for changes to any National Map, spec, or Cesium source file that was pulled in to <code>ausglobe.js</code>. When a change to any of these files is detected, a fast incremental build is automatically kicked off.  The incremental build is much faster than the full rebuild because dependencies between source files are cached.</li>
<li><code>release</code> - The same as <code>build</code> except that it also minifies <code>ausglobe.js</code>.  This task should be used when building for production.</li>
<li><code>build-app</code> - The same as <code>build</code>, except it builds just the app, not the specs.</li>
<li><code>build-specs</code> - The same as <code>build</code>, except it builds just the specs, not the app.  Note that the specs do not actually depending on the app, so there is no need to <code>build-app</code> if you're just iterating on the specs, even if you change app source files.</li>
<li><code>watch-app</code> - Watches just the app for changes.</li>
<li><code>watch-specs</code> - Watches just the specs for changes.</li>
<li><code>release-app</code> - Does a release build of just the app.</li>
<li><code>release-specs</code> - Does a release build of just the specs.</li>
<li><code>lint</code> - Runs jshint on the files in the <code>src</code> folder and reports any problems.  Our <a href="https://github.com/NICTA/nationalmap/blob/master/src/.jshintrc">.jshintrc</a> file is mostly just copied from Cesium at the moment, so suggested changes are welcome.</li>
<li><code>docs</code> - Generates reference documentation for the files in the <code>src</code> folder.</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Contributing-to-TerriaJS/" class="btn btn-neutral float-right" title="Working with TerriaJS and Cesium">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../" class="btn btn-neutral" title="Overview"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Contributing-to-TerriaJS/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
